#!/bin/bash

# 代碼品質檢查腳本

set -e

PROJECT_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
SOURCE_DIR="${PROJECT_ROOT}/{{SOURCE_DIR}}"

echo "🔍 執行代碼品質檢查..."

# 根據專案類型執行不同的檢查
case "{{PROJECT_TYPE}}" in
    "flutter-app")
        flutter analyze
        ;;
    "web-app")
        if [ -f "$PROJECT_ROOT/package.json" ]; then
            npm run lint || yarn lint || echo "未找到 lint 命令"
        fi
        ;;
    "python")
        if command -v flake8 &> /dev/null; then
            flake8 $SOURCE_DIR
        elif command -v pylint &> /dev/null; then
            pylint $SOURCE_DIR
        fi
        ;;
    *)
        echo "執行通用代碼檢查..."
        # 檢查尾隨空格
        ! grep -r '[[:space:]]$' $SOURCE_DIR --include="*.{{FILE_EXT}}"
        
        # 檢查 Tab 與空格混用
        ! grep -r $'\t' $SOURCE_DIR --include="*.{{FILE_EXT}}" | grep ' '
        ;;
esac

echo "✅ 代碼品質檢查完成"