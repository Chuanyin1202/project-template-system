#!/bin/bash

# ä»£ç¢¼å“è³ªæª¢æŸ¥è…³æœ¬

set -e

PROJECT_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
SOURCE_DIR="${PROJECT_ROOT}/{{SOURCE_DIR}}"

echo "ğŸ” åŸ·è¡Œä»£ç¢¼å“è³ªæª¢æŸ¥..."

# æ ¹æ“šå°ˆæ¡ˆé¡å‹åŸ·è¡Œä¸åŒçš„æª¢æŸ¥
case "{{PROJECT_TYPE}}" in
    "flutter-app")
        flutter analyze
        ;;
    "web-app")
        if [ -f "$PROJECT_ROOT/package.json" ]; then
            npm run lint || yarn lint || echo "æœªæ‰¾åˆ° lint å‘½ä»¤"
        fi
        ;;
    "python")
        if command -v flake8 &> /dev/null; then
            flake8 $SOURCE_DIR
        elif command -v pylint &> /dev/null; then
            pylint $SOURCE_DIR
        fi
        ;;
    *)
        echo "åŸ·è¡Œé€šç”¨ä»£ç¢¼æª¢æŸ¥..."
        # æª¢æŸ¥å°¾éš¨ç©ºæ ¼
        ! grep -r '[[:space:]]$' $SOURCE_DIR --include="*.{{FILE_EXT}}"
        
        # æª¢æŸ¥ Tab èˆ‡ç©ºæ ¼æ··ç”¨
        ! grep -r $'\t' $SOURCE_DIR --include="*.{{FILE_EXT}}" | grep ' '
        ;;
esac

echo "âœ… ä»£ç¢¼å“è³ªæª¢æŸ¥å®Œæˆ"